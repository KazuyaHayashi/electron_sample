general:
  branches:
    only:
      - circleci_macOS
      - /feature.*/

machine:
  environment:
    XCODE_SCHEME: test
    XCODE_WORKSPACE: test
    XCODE_PROJECT: test
    WINEDLLOVERRIDES: mscoree,mshtml=
    WINEDEBUG: -all

  xcode:
    version: 7.0

dependencies:
  pre:
    - |
      pushd $HOME
      python -m virtualenv .awscli
      pushd .awscli
      source bin/activate
      pip install awscli --ignore-installed six
      deactivate
      popd
      popd
    - echo 'export PATH=$HOME/.homebrew/bin:$HOME/.awscli/bin:$PATH' >>~/.bashrc
    - echo 'export HOMEBREW_CASK_OPTS="--caskroom=$HOME/.homebrew/Caskroom --appdir=$HOME/Applications"' >>~/.bashrc
    - . ~/.bashrc
    - brew cask reinstall xquartz
    - brew install wine mono winetricks
    - brew upgrade npm
    - npm install -g npm@5.4.1

  cache_directories:
    - ~/.homebrew

test:
  override:
    - DEBUG=electron-packager npm run pack:win:
        timeout: 1200
  post:
    - mv dist $CIRCLE_ARTIFACTS
